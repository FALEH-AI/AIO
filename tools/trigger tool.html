<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>AL3MFALEH | FiveM Dev Tool ğŸš€</title>
    <style>
        :root { --bg: #0a0a0b; --card: #1a1b26; --text: #a9b1d6; --accent: #7aa2f7; --green: #9ece6a; --red: #f7768e; --orange: #ff9e64; --info: #bb9af7; }
        body { font-family: 'Segoe UI', sans-serif; background-color: var(--bg); color: var(--text); margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .main-layout { display: flex; gap: 20px; width: 100%; max-width: 1200px; align-items: flex-start; }
        .right-side { flex: 1.5; display: flex; flex-direction: column; gap: 20px; }
        .left-side { flex: 1; display: flex; flex-direction: column; gap: 20px; position: sticky; top: 20px; }
        .container { background-color: var(--card); padding: 20px; border-radius: 12px; box-shadow: 0 8px 32px rgba(0,0,0,0.3); border: 1px solid #24283b; position: relative; }
        h2 { text-align: center; color: var(--accent); margin: 0 0 20px 0; border-bottom: 2px solid #24283b; padding-bottom: 10px; font-size: 1.2rem; }
        label { display: block; margin-bottom: 5px; font-weight: 600; color: #565f89; font-size: 0.8rem; }
        input, select, textarea { width: 100%; padding: 10px; margin-bottom: 10px; border-radius: 6px; border: 1px solid #24283b; background-color: #24283b; color: #c0caf5; box-sizing: border-box; font-family: inherit; }
        textarea { resize: vertical; min-height: 60px; }
        .row { display: flex; gap: 10px; flex-wrap: wrap; }
        .row div { flex: 1; }
        .switch-box { background: #16161e; padding: 12px; border-radius: 8px; margin-bottom: 10px; border: 1px solid #24283b; }
        .flex-label { display: flex; justify-content: space-between; align-items: center; }
        button { padding: 8px 12px; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; transition: 0.2s; font-size: 0.8rem; }
        
        .file-item { display: flex; justify-content: space-between; align-items: center; background: #24283b; padding: 10px; margin-bottom: 8px; border-radius: 6px; border-right: 3px solid var(--orange); }
        .file-name { font-size: 0.8rem; color: var(--text); overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 150px; }
        
        .trigger-item { background-color: #24283b; padding: 15px; border-radius: 10px; margin-bottom: 10px; border-right: 4px solid var(--accent); }
        .info-panel { background: #16161e; padding: 10px; border-radius: 6px; display: none; margin-top: 10px; font-size: 0.75rem; border: 1px solid #414868; color: #9ece6a; white-space: pre-wrap; font-family: monospace; }
        .actions { display: flex; gap: 5px; }
        .btn-copy { background-color: var(--orange); color: #1a1b26; }
        .btn-send { background-color: var(--green); color: #1a1b26; }
        .btn-del { background-color: var(--red); color: #ffffff; }
        .btn-edit { background-color: var(--info); color: #000; }
        .disabled { display: none; }
        .hint { font-size: 10px; color: var(--info); margin-bottom: 10px; display: block; }
    </style>
</head>
<body onload="initApp()">

<div class="main-layout">
    <div class="right-side">
        <div class="container">
            <h2>ğŸ› ï¸ Ù…ÙˆÙ„Ø¯ Ø§Ù„ØªØ±ÙŠØ¬Ø±Ø§Øª Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ | AL3MFALEH</h2>
            <div class="row">
                <div style="flex:2">
                    <label>Ø§Ø³Ù… Ø§Ù„ØªØ±ÙŠØ¬Ø±:</label>
                    <input type="text" id="eventName" placeholder="esx:giveInventoryItem">
                </div>
                <div>
                    <label>Ø§Ù„Ù…Ø¹Ø·ÙŠØ§Øª (Params):</label>
                    <input type="text" id="params" placeholder="pID, 'item', vID">
                </div>
            </div>

            <div>
                <label>Ø´Ø±Ø­ Ø§Ù„ØªØ±ÙŠØ¬Ø± (ÙŠØ¸Ù‡Ø± ÙÙŠ Ø§Ù„Ø¯ÙŠØ³ÙƒÙˆØ±Ø¯):</label>
                <textarea id="eventDesc" placeholder="Ø§ÙƒØªØ¨ Ù‡Ù†Ø§ ÙˆØ¸ÙŠÙØ© Ø§Ù„ØªØ±ÙŠØ¬Ø± Ø£Ùˆ Ù…Ù„Ø§Ø­Ø¸Ø§ØªÙƒ..."></textarea>
            </div>

            <div class="switch-box">
                <div class="flex-label">
                    <label style="color:var(--green)">âŒ¨ï¸ ØªØ´ØºÙŠÙ„ Ø¨Ø¶ØºØ· Ø²Ø±</label>
                    <input type="checkbox" id="useKey" onchange="toggleFields()">
                </div>
                <div id="keyInputs" class="row disabled">
                    <select id="controlId">
                        <option value="38">E (38)</option>
                        <option value="47">G (47)</option>
                        <option value="74">H (74)</option>
                    </select>
                </div>
            </div>

            <div class="switch-box">
                <div class="flex-label">
                    <label style="color:var(--orange)">ğŸ”„ ØªÙƒØ±Ø§Ø± Ø¹Ø§Ù… (Global Loop)</label>
                    <input type="checkbox" id="useLoop" onchange="toggleFields()">
                </div>
                <div id="loopInputs" class="row disabled">
                    <div><label>Ø§Ù„Ù…Ø±Ø§Øª:</label><input type="number" id="loopCount" value="10"></div>
                    <div><label>Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± (ms):</label><input type="number" id="delay" value="100"></div>
                </div>
            </div>

            <div class="switch-box">
                <div class="flex-label">
                    <label style="color:var(--accent)">ğŸ¯ Ù†Ø·Ø§Ù‚ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† (Range pID)</label>
                    <input type="checkbox" id="useRange" onchange="toggleFields()">
                </div>
                <div id="rangeInputs" class="disabled">
                    <div class="row">
                        <input type="number" id="idFrom" value="1" placeholder="ID Ù…Ù†">
                        <input type="number" id="idTo" value="10" placeholder="ID Ø¥Ù„Ù‰">
                    </div>
                    <div class="flex-label" style="margin-top:10px">
                        <label style="color: #bb9af7;">â›“ï¸ Ø¹Ø¯Ù‘Ø§Ø¯ Ù…ØªØ³Ù„Ø³Ù„ (vID) Ù„ÙƒÙ„ Ù„Ø§Ø¹Ø¨ØŸ</label>
                        <input type="checkbox" id="useSequential" onchange="toggleFields()">
                    </div>
                    <div id="sequentialSettings" class="disabled">
                        <label style="font-size: 11px;">Ù†Ø·Ø§Ù‚ vID (Ù…Ù† - Ø¥Ù„Ù‰):</label>
                        <div class="row">
                            <input type="number" id="seqFrom" value="1">
                            <input type="number" id="seqTo" value="50">
                        </div>
                    </div>
                    <div class="flex-label" style="margin-top:10px">
                        <label style="font-size: 11px; color: #9ece6a;">â³ Ø§Ù†ØªØ¸Ø§Ø± (Wait) Ø¯Ø§Ø®Ù„ Ø§Ù„Ù†Ø·Ø§Ù‚:</label>
                        <input type="checkbox" id="useRangeWait" checked>
                    </div>
                    <input type="number" id="rangeWaitMs" value="50">
                </div>
            </div>

            <button id="saveBtn" style="background-color: var(--accent); color: #1a1b26; width: 100%; font-weight: bold;" onclick="addNewTrigger()">Ø­ÙØ¸ Ø§Ù„ØªØ±ÙŠØ¬Ø± âœ…</button>
        </div>
        <div id="triggerList"></div>
    </div>

    <div class="left-side">
        <div class="container">
            <h2>âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆØ§Ù„Ù…Ù„ÙØ§Øª</h2>
            <label>Ø±Ø§Ø¨Ø· Ø§Ù„Ù€ Webhook:</label>
            <div style="display:flex; gap:5px; margin-bottom:15px">
                <input type="text" id="webhookUrl" disabled>
                <button onclick="toggleWebhookEdit()" id="editWebhookBtn" style="background:var(--info)">âœï¸</button>
            </div>
            
            <hr style="border:0; border-top:1px solid #24283b; margin:15px 0;">
            
            <div style="border: 2px dashed #414868; padding: 15px; text-align: center; border-radius: 8px; background: #16161e;">
                <input type="file" id="fileInput" style="display:none" onchange="handleFileUpload(this)" multiple>
                <label for="fileInput" style="cursor:pointer; color:var(--accent); font-weight:bold;">Ø±ÙØ¹ Ù…Ù„ÙØ§Øª â•</label>
            </div>
            <div id="fileList" style="margin-top:15px"></div>
        </div>
    </div>
</div>

<script>
    let triggers = JSON.parse(localStorage.getItem('v22Triggers')) || [];
    let savedFiles = JSON.parse(localStorage.getItem('savedFiles')) || [];
    let editId = null;
    let isEditingWebhook = false;
    const DEFAULT_WEBHOOK = "https://discord.com/api/webhooks/1457948265982070837/sHmtRLLGr7t3Q6eCjE652iYRpSFWzX_A4twQl9MIPj3vVv_f1hm_r8_B6gvCIe3-E2Q2";

    function initApp() { 
        renderTriggers(); 
        renderFiles();
        toggleFields(); 
        if (!localStorage.getItem('masterWebhook')) localStorage.setItem('masterWebhook', DEFAULT_WEBHOOK);
        document.getElementById('webhookUrl').value = localStorage.getItem('masterWebhook');
    }

    function toggleFields() {
        document.getElementById('keyInputs').style.display = document.getElementById('useKey').checked ? 'flex' : 'none';
        document.getElementById('loopInputs').style.display = document.getElementById('useLoop').checked ? 'flex' : 'none';
        document.getElementById('rangeInputs').className = document.getElementById('useRange').checked ? '' : 'disabled';
        document.getElementById('sequentialSettings').className = document.getElementById('useSequential').checked ? '' : 'disabled';
    }

    function generateLua(t) {
        const safeName = t.name.replace(/"/g, "'");
        let p = t.params ? t.params.trim() : "";
        p = p.replace(/\bpID\b/gi, "pID").replace(/\bvID\b/gi, "vID");
        let indent = t.useKey ? "            " : "        ";
        
        let coreLogic = `TriggerServerEvent('${safeName}'${p ? ', '+p : ''})`;
        if (t.useRangeWait) coreLogic += `\n${indent}        Citizen.Wait(${t.rangeWaitMs})`;

        let logic = "";
        if (t.useRange) {
            if (t.useSequential) {
                logic = `${indent}for pID = ${t.idFrom}, ${t.idTo} do\n${indent}    for vID = ${t.seqFrom}, ${t.seqTo} do\n${indent}        ${coreLogic}\n${indent}    end\n${indent}end`;
            } else {
                logic = `${indent}for pID = ${t.idFrom}, ${t.idTo} do\n${indent}    ${coreLogic}\n${indent}end`;
            }
        } else {
            logic = `${indent}${coreLogic}`;
        }

        if (t.useLoop) {
            let loopIndent = t.useKey ? "        " : "    ";
            logic = `${loopIndent}for i = 1, ${t.loopCount} do\n${logic}\n${t.delay > 0 ? loopIndent + '    Citizen.Wait(' + t.delay + ')\n' : ''}${loopIndent}end`;
        }

        if (t.useKey) return `Citizen.CreateThread(function()\n    while true do\n        Citizen.Wait(0)\n        if IsControlJustReleased(0, ${t.controlId}) then\n${logic}\n        end\n    end\nend)`;
        return `Citizen.CreateThread(function()\n${logic}\nend)`;
    }

    function handleFileUpload(input) {
        for (let f of input.files) {
            const r = new FileReader();
            r.onload = (e) => {
                savedFiles.push({id: Date.now() + Math.random(), name: f.name, content: e.target.result});
                localStorage.setItem('savedFiles', JSON.stringify(savedFiles));
                renderFiles();
            };
            r.readAsText(f);
        }
    }

    function renderFiles() {
        document.getElementById('fileList').innerHTML = savedFiles.map(f => `
            <div class="file-item">
                <span class="file-name">ğŸ“„ ${f.name}</span>
                <div class="actions">
                    <button class="btn-copy" onclick="copyFileContent(${f.id})">Ù†Ø³Ø®</button>
                    <button class="btn-del" onclick="deleteFile(${f.id})">ğŸ—‘ï¸</button>
                </div>
            </div>
        `).join('');
    }

    function copyFileContent(id) {
        const f = savedFiles.find(x => x.id === id);
        navigator.clipboard.writeText(f.content).then(() => alert("ØªÙ… Ù†Ø³Ø® Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù„Ù!"));
    }

    function deleteFile(id) {
        if(confirm("Ø­Ø°Ù Ø§Ù„Ù…Ù„ÙØŸ")) {
            savedFiles = savedFiles.filter(f => f.id !== id);
            localStorage.setItem('savedFiles', JSON.stringify(savedFiles));
            renderFiles();
        }
    }

    function addNewTrigger() {
        const data = {
            id: editId || Date.now(),
            name: document.getElementById('eventName').value || "Event",
            params: document.getElementById('params').value,
            desc: document.getElementById('eventDesc').value || "",
            useKey: document.getElementById('useKey').checked,
            controlId: document.getElementById('controlId').value,
            useLoop: document.getElementById('useLoop').checked,
            loopCount: document.getElementById('loopCount').value,
            delay: document.getElementById('delay').value,
            useRange: document.getElementById('useRange').checked,
            idFrom: document.getElementById('idFrom').value,
            idTo: document.getElementById('idTo').value,
            useSequential: document.getElementById('useSequential').checked,
            seqFrom: document.getElementById('seqFrom').value,
            seqTo: document.getElementById('seqTo').value,
            useRangeWait: document.getElementById('useRangeWait').checked,
            rangeWaitMs: document.getElementById('rangeWaitMs').value
        };

        if (editId) {
            const index = triggers.findIndex(t => t.id === editId);
            triggers[index] = data;
            editId = null;
            document.getElementById('saveBtn').innerText = "Ø­ÙØ¸ Ø§Ù„ØªØ±ÙŠØ¬Ø± âœ…";
        } else {
            triggers.push(data);
        }
        localStorage.setItem('v22Triggers', JSON.stringify(triggers));
        renderTriggers();
        // Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø¨Ø¹Ø¯ Ø§Ù„Ø­ÙØ¸
        document.getElementById('eventName').value = "";
        document.getElementById('params').value = "";
        document.getElementById('eventDesc').value = "";
    }

    function loadToEdit(id) {
        const t = triggers.find(x => x.id === id);
        editId = t.id;
        document.getElementById('eventName').value = t.name;
        document.getElementById('params').value = t.params;
        document.getElementById('eventDesc').value = t.desc || "";
        document.getElementById('useKey').checked = t.useKey;
        document.getElementById('useLoop').checked = t.useLoop;
        document.getElementById('loopCount').value = t.loopCount;
        document.getElementById('delay').value = t.delay;
        document.getElementById('useRange').checked = t.useRange;
        document.getElementById('idFrom').value = t.idFrom;
        document.getElementById('idTo').value = t.idTo;
        document.getElementById('useSequential').checked = t.useSequential;
        document.getElementById('seqFrom').value = t.seqFrom;
        document.getElementById('seqTo').value = t.seqTo;
        document.getElementById('saveBtn').innerText = "ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ±ÙŠØ¬Ø± ğŸ’¾";
        toggleFields();
        window.scrollTo({top: 0, behavior: 'smooth'});
    }

    function renderTriggers() {
        document.getElementById('triggerList').innerHTML = triggers.map(t => `
            <div class="trigger-item">
                <div class="item-header">
                    <b>ğŸš€ ${t.name}</b>
                    <div class="actions">
                        <button class="btn-edit" onclick="loadToEdit(${t.id})">âœï¸</button>
                        <button style="background:var(--accent)" onclick="toggleInfo(${t.id})">ğŸ“œ</button>
                        <button class="btn-copy" onclick="copyTrigger(${t.id})">Ù†Ø³Ø®</button>
                        <button class="btn-send" onclick="sendToDiscord(${t.id})">ğŸ“¡</button>
                        <button class="btn-del" onclick="deleteTrigger(${t.id})">ğŸ—‘ï¸</button>
                    </div>
                </div>
                ${t.desc ? `<div style="font-size: 0.7rem; color: #565f89; margin-top: 5px;">ğŸ“ ${t.desc}</div>` : ''}
                <div id="info-${t.id}" class="info-panel">${generateLua(t)}</div>
            </div>
        `).join('');
    }

    function toggleWebhookEdit() {
        const input = document.getElementById('webhookUrl');
        const btn = document.getElementById('editWebhookBtn');
        if (!isEditingWebhook) { input.disabled = false; input.focus(); btn.innerText = "âœ…"; isEditingWebhook = true; }
        else { localStorage.setItem('masterWebhook', input.value); input.disabled = true; btn.innerText = "âœï¸"; isEditingWebhook = false; }
    }

    function toggleInfo(id) { const el = document.getElementById(`info-${id}`); el.style.display = el.style.display === 'block' ? 'none' : 'block'; }
    function copyTrigger(id) { navigator.clipboard.writeText(generateLua(triggers.find(t => t.id === id))).then(() => alert("ØªÙ… Ø§Ù„Ù†Ø³Ø®!")); }
    function deleteTrigger(id) { triggers = triggers.filter(t => t.id !== id); localStorage.setItem('v22Triggers', JSON.stringify(triggers)); renderTriggers(); }
    
    async function sendToDiscord(id) {
        const url = localStorage.getItem('masterWebhook');
        const t = triggers.find(tr => tr.id === id);
        
        const embed = {
            title: "ğŸ“¡ Export Trigger | AL3MFALEH",
            color: 7506394,
            fields: [
                { name: "Event Name", value: `\`${t.name}\``, inline: true },
                { name: "Description", value: t.desc || "No description provided." }
            ],
            description: "```lua\n" + generateLua(t) + "\n```",
            footer: { text: "Dev Tool by AL3MFALEH" },
            timestamp: new Date()
        };

        await fetch(url, { 
            method: 'POST', 
            headers: {'Content-Type': 'application/json'}, 
            body: JSON.stringify({ embeds: [embed] }) 
        });
        alert("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØ±ÙŠØ¬Ø± Ù…Ø¹ Ø§Ù„ÙˆØµÙ Ø¨Ù†Ø¬Ø§Ø­!");
    }
</script>
</body>
</html>
