<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Triggers Finding - AL3MFALEH Ultimate</title>
    <style>
    body { font-family: 'Segoe UI', Tahoma, sans-serif; padding: 20px; background: #0a0a0b; color: #a9b1d6; display: flex; gap: 20px; margin: 0; }
    .sidebar { width: 260px; background: #16161e; padding: 20px; border-radius: 0 12px 12px 0; border-left: 1px solid #24283b; height: 100vh; position: sticky; top: 0; box-sizing: border-box; overflow-y: auto; }
    .sidebar h3 { font-size: 16px; color: #7aa2f7; margin-bottom: 15px; border-bottom: 1px solid #24283b; padding-bottom: 10px; }
    .saved-item { display: flex; justify-content: space-between; align-items: center; background: #1a1b26; padding: 10px; margin-bottom: 8px; border-radius: 6px; font-size: 13px; cursor: pointer; border: 1px solid transparent; color: #a9b1d6; }
    .saved-item:hover { border-color: #7aa2f7; }
    .main-content { flex-grow: 1; padding: 20px; max-width: 1000px; margin: auto; }
    .header-area { text-align: center; margin-bottom: 20px; }
    .header-area h2 { color: #7aa2f7; margin: 0; }
    .rights-text { font-size: 12px; color: #565f89; letter-spacing: 2px; margin-top: 5px; font-weight: bold; }
    .management-box { background: #16161e; padding: 20px; border-radius: 12px; border: 1px solid #24283b; margin-bottom: 20px; }
    .tags-container { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 15px; min-height: 30px; }
    .tag { background: #7aa2f7; color: #0a0a0b; padding: 6px 14px; border-radius: 20px; font-size: 12px; display: flex; align-items: center; gap: 8px; font-weight: bold; }
    input { padding: 12px; border-radius: 6px; border: 1px solid #24283b; background: #1a1b26; color: #fff; text-align: right; outline: none; width: 100%; box-sizing: border-box; }
    input:focus { border-color: #7aa2f7; }
    textarea { width: 100%; height: 400px; padding: 15px; border-radius: 8px; border: 1px solid #24283b; background: #0a0a0b; color: #9ece6a; font-family: 'Consolas', monospace; direction: ltr; text-align: left; white-space: pre; box-sizing: border-box; font-size: 14px; }
    .btn-main { background-color: #7aa2f7; color: #0a0a0b; width: 100%; margin-bottom: 15px; font-size: 16px; font-weight: bold; cursor: pointer; border: none; padding: 15px; border-radius: 8px; }
    .buttons-row { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 15px; }
    .buttons-row button { flex: 1; padding: 12px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; min-width: 120px; }
    .modal { display: none; position: fixed; z-index: 100; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); }
    .modal-content { background-color: #16161e; margin: 15% auto; padding: 25px; border: 1px solid #7aa2f7; width: 400px; border-radius: 12px; text-align: center; color: white; }
    .server-input { flex: 2 !important; }
</style>
</head>
<body>

    <div class="sidebar">
        <h3>ğŸ’¾ Ø§Ù„Ø­ÙˆØ§ÙØ¸ Ø§Ù„Ø¯Ø§Ø¦Ù…Ø©</h3>
        <div id="savedList"></div>
    </div>

    <div class="main-content">
        <div class="header-area">
            <h2>Triggers Finding</h2>
            <div class="rights-text">POWERED BY AL3MFALEH</div>
        </div>

        <div class="management-box">
            <div id="tagsContainer" class="tags-container"></div>
            <div style="display: flex; gap: 8px; margin-bottom: 12px;">
                <input type="text" id="newWordInput" placeholder="Ø£Ø¶Ù ÙƒÙ„Ù…Ø© Ù„Ù„ÙÙ„ØªØ± Ø§Ù„Ø­ØµØ±...">
                <button style="background: #03dac6; color: black; width: 100px; cursor:pointer; border:none; border-radius:6px;" onclick="addNewTag()">Ø¥Ø¶Ø§ÙØ©</button>
                <button style="background: #3700b3; color: white; width: 120px; cursor:pointer; border:none; border-radius:6px;" onclick="saveToSidebar()">Ø­ÙØ¸ Ø¯Ø§Ø¦Ù…</button>
            </div>
            <input type="text" id="manualSearch" style="border: 2px solid #03dac6;" placeholder="ğŸ” Ø¨Ø­Ø« ÙŠØ¯ÙˆÙŠ Ù…Ø¨Ø§Ø´Ø± Ø¯Ø§Ø®Ù„ Ø§Ù„Ø£ÙƒÙˆØ§Ø¯..." onkeyup="filterResults()">
            <div style="margin-top: 10px; font-size: 13px; color: #03dac6;">
                <input type="checkbox" id="filterActive" onchange="filterResults()" checked>
                <label for="filterActive">ØªÙØ¹ÙŠÙ„ Ù†Ø¸Ø§Ù… Ø§Ù„Ø­ØµØ± (Tags)</label>
            </div>
        </div>

        <button class="btn-main" onclick="document.getElementById('folderInput').click()">ğŸ“ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø¬Ù„Ø¯ ÙˆÙØ­ØµÙ‡ Ø§Ù„Ø¢Ù†</button>
        <input type="file" id="folderInput" webkitdirectory directory multiple style="display: none;" onchange="processFolder(this.files)">

        <div id="fileStatus" style="color: #bb86fc; font-size: 14px; margin-bottom: 10px;">Ø¬Ø§Ù‡Ø²...</div>
        <textarea id="resultArea" readonly></textarea>

        <div class="buttons-row">
            <input type="text" id="serverNameMain" class="server-input" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ø³ÙŠØ±ÙØ± Ù‡Ù†Ø§..." oninput="localStorage.setItem('al3_server', this.value)">
            <button style="background: #2196F3; color: white;" onclick="openWebhookModal()">âš™ï¸ Ø§Ù„ÙˆÙŠØ¨ Ù‡ÙˆÙƒ</button>
            <button style="background: #e91e63; color: white;" onclick="sendToWebhookAsFile()">ğŸ“ Ø¥Ø±Ø³Ø§Ù„ Ù…Ù„Ù Ù„Ù„Ø¯ÙŠØ³ÙƒÙˆØ±Ø¯</button>
            <button style="background: #4caf50; color: white; display: none;" id="downloadBtn" onclick="downloadTxt()">ğŸ’¾ ØªØ­Ù…ÙŠÙ„ TXT</button>
            <button style="background: #ffc107; color: black;" onclick="enableEditing()">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>
        </div>

        <div style="text-align: center; margin-top: 20px; font-size: 12px; color: #565f89;">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© &copy; 2026 | <b>AL3MFALEH</b></div>
    </div>

    <div id="webhookModal" class="modal">
        <div class="modal-content">
            <h3 style="color: #03dac6;">Ø±Ø§Ø¨Ø· Ø§Ù„ÙˆÙŠØ¨ Ù‡ÙˆÙƒ</h3>
            <input type="text" id="webhookUrlInput" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ÙˆÙŠØ¨ Ù‡ÙˆÙƒ...">
            <button style="background: #03dac6; margin-top:20px; padding:10px 20px; border:none; border-radius:6px; cursor:pointer;" onclick="saveWebhook()">Ø­ÙØ¸</button>
            <button style="background: #333; color:white; margin-top:20px; padding:10px 20px; border:none; border-radius:6px; cursor:pointer;" onclick="closeWebhookModal()">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
    </div>

<script>
    let originalData = []; 
    let filterWords = [];
    let savedKeywords = JSON.parse(localStorage.getItem('al3_keys')) || ['TargetId', 'playerId', 'Citizenid'];
    
    // Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ø§Ù„Ø°ÙŠ Ø²ÙˆØ¯ØªÙ†ÙŠ Ø¨Ù‡
    const defaultWebhook = "https://discord.com/api/webhooks/1457952736946552883/77J_mPUC3h77luu0X1SQZd4jkDHrzjwhlv3YgqlZyiOk3uyTDnkYV7f8Sx7-zQfFt2UI";

    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ ÙˆÙŠØ¨ Ù‡ÙˆÙƒ Ù…Ø®Ø²Ù† Ù…Ø³Ø¨Ù‚Ø§Ù‹ØŒ ÙˆØ¥Ù„Ø§ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
    if (!localStorage.getItem('al3_webhook')) {
        localStorage.setItem('al3_webhook', defaultWebhook);
    }

    document.getElementById('serverNameMain').value = localStorage.getItem('al3_server') || '';

    function openWebhookModal() {
        document.getElementById('webhookUrlInput').value = localStorage.getItem('al3_webhook') || '';
        document.getElementById('webhookModal').style.display = "block";
    }
    function closeWebhookModal() { document.getElementById('webhookModal').style.display = "none"; }
    function saveWebhook() { localStorage.setItem('al3_webhook', document.getElementById('webhookUrlInput').value.trim()); closeWebhookModal(); }

    function addNewTag() {
        const word = document.getElementById('newWordInput').value.trim().toLowerCase();
        if (word && !filterWords.includes(word)) { filterWords.push(word); document.getElementById('newWordInput').value = ''; updateTagsUI(); }
    }
    function removeTag(index) { filterWords.splice(index, 1); updateTagsUI(); }
    function updateTagsUI() {
        const container = document.getElementById('tagsContainer'); container.innerHTML = '';
        filterWords.forEach((word, index) => { container.innerHTML += `<div class="tag">${word} <span style="cursor:pointer;margin-right:5px" onclick="removeTag(${index})">Ã—</span></div>`; });
        filterResults();
    }

    async function processFolder(files) {
        originalData = []; let fileCount = 0;
        document.getElementById('resultArea').value = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ÙØ­Øµ...";
        for (let file of files) {
            if ((file.name.endsWith('.lua') || file.name.endsWith('.js')) && file.size < 1000000) {
                fileCount++; const content = await file.text();
                let index = content.indexOf("TriggerServerEvent");
                while (index !== -1) {
                    let bc = 0, st = false, ft = "";
                    for (let i = index; i < content.length; i++) {
                        ft += content[i]; if (content[i] === '(') { bc++; st = true; } else if (content[i] === ')') bc--;
                        if (st && bc === 0) { originalData.push({ path: file.webkitRelativePath, code: ft.trim() }); break; }
                        if (ft.length > 500) break;
                    }
                    index = content.indexOf("TriggerServerEvent", index + 1);
                }
            }
        }
        filterResults();
        document.getElementById('fileStatus').innerText = `ÙˆØ¬Ø¯Ù†Ø§: ${originalData.length} ØªØ±Ù‚Ø± ÙÙŠ ${fileCount} Ù…Ù„ÙØ§Øª`;
        document.getElementById('downloadBtn').style.display = 'inline-block';
    }

    function filterResults() {
        const manual = document.getElementById('manualSearch').value.toLowerCase();
        const active = document.getElementById('filterActive').checked;
        const filtered = originalData.filter(item => {
            const c = item.code.toLowerCase();
            const passTags = active && filterWords.length > 0 ? filterWords.some(w => c.includes(w)) : true;
            return passTags && c.includes(manual);
        });
        document.getElementById('resultArea').value = `--- ØªÙ‚Ø±ÙŠØ± AL3MFALEH ---\nØ§Ù„Ø³ÙŠØ±ÙØ±: ${localStorage.getItem('al3_server')}\n\n` + filtered.map(item => `[FILE: ${item.path}]\nCODE: ${item.code}\n-------------------`).join('\n');
    }

    async function sendToWebhookAsFile() {
        const url = localStorage.getItem('al3_webhook');
        const server = localStorage.getItem('al3_server') || "ØºÙŠØ±_Ù…Ø­Ø¯Ø¯";
        const now = new Date();
        const dateStr = now.toLocaleDateString('en-GB'); 
        const timeStr = now.toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit' });

        if (!url) return alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø±Ø§Ø¨Ø·!");
        if (originalData.length === 0 && document.getElementById('resultArea').value === "") return alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬!");

        const blob = new Blob([document.getElementById('resultArea').value], { type: 'text/plain' });
        const formData = new FormData();
        formData.append('file', new File([blob], `Report_${server}.txt`));
        
        const messageContent = `ğŸ“‚ **ØªÙ‚Ø±ÙŠØ± Ø¬Ø¯ÙŠØ¯ Ù…Ù†:** \`${server}\`\nğŸ“… **Ø§Ù„ØªØ§Ø±ÙŠØ®:** \`${dateStr}\`\nâ° **Ø§Ù„ÙˆÙ‚Øª:** \`${timeStr}\`\nğŸ‘¤ **Ø¨ÙˆØ§Ø³Ø·Ø©:** AL3MFALEH`;

        formData.append('payload_json', JSON.stringify({ 
            content: messageContent, 
            username: "AL3MFALEH Scanner" 
        }));

        try {
            const res = await fetch(url, { method: 'POST', body: formData });
            if (res.ok) alert("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ù„Ù ÙˆØ§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨Ù†Ø¬Ø§Ø­!");
            else alert("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„. ØªØ£ÙƒØ¯ Ù…Ù† ØµØ­Ø© Ø±Ø§Ø¨Ø· Ø§Ù„ÙˆÙŠØ¨ Ù‡ÙˆÙƒ.");
        } catch (e) { alert("ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„ÙˆÙŠØ¨ Ù‡ÙˆÙƒ."); }
    }

    function updateSidebarUI() {
        const container = document.getElementById('savedList'); container.innerHTML = '';
        savedKeywords.forEach((word, index) => {
            container.innerHTML += `<div class="saved-item"><div style="flex-grow:1" onclick="if(!filterWords.includes('${word.toLowerCase()}')){filterWords.push('${word.toLowerCase()}');updateTagsUI()}">${word}</div> <span onclick="removeFromSidebar(${index})" style="color:#ff4d4d">Ã—</span></div>`;
        });
        localStorage.setItem('al3_keys', JSON.stringify(savedKeywords));
    }
    function saveToSidebar() {
        const val = document.getElementById('newWordInput').value.trim();
        if (val && !savedKeywords.includes(val)) { savedKeywords.push(val); updateSidebarUI(); }
    }
    function removeFromSidebar(index) { savedKeywords.splice(index, 1); updateSidebarUI(); }
    function enableEditing() { document.getElementById('resultArea').readOnly = false; document.getElementById('resultArea').focus(); alert("Ø§Ù„Ø¢Ù† ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø¯Ø§Ø®Ù„ ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù†ØªØ§Ø¦Ø¬."); }
    function downloadTxt() {
        const a = document.createElement('a'); a.download = 'AL3MFALEH_Report.txt';
        a.href = URL.createObjectURL(new Blob([document.getElementById('resultArea').value], {type:'text/plain'}));
        a.click();
    }
    updateSidebarUI();
</script>
</body>
</html>